# Default values for maintenance-operator

replicaCount: 1

image:
  repository: ghcr.io/mithucste30/maintenance-operator
  pullPolicy: IfNotPresent
  tag: "0.3.1"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: true

service:
  type: ClusterIP
  port: 8080
  targetPort: 8080

resources:
  limits:
    cpu: 200m
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 128Mi

nodeSelector: {}

tolerations: []

affinity: {}

# Maintenance page configuration
maintenance:
  # Default HTTP status code for maintenance pages
  httpStatusCode: 503

  # Default maintenance page (used when no custom page is specified)
  # HTML is base64 encoded to keep values.yaml clean
  defaultPage:
    # Base64 encoded HTML (decode to see/edit the actual HTML)
    htmlBase64: "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8dGl0bGU+U2l0ZSBVbmRlciBNYWludGVuYW5jZTwvdGl0bGU+CiAgICA8c3R5bGU+CiAgICAgICAgYm9keSB7CiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAtYXBwbGUtc3lzdGVtLCBCbGlua01hY1N5c3RlbUZvbnQsICdTZWdvZSBVSScsIFJvYm90bywgT3h5Z2VuLCBVYnVudHUsIENhbnRhcmVsbCwgc2Fucy1zZXJpZjsKICAgICAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzY2N2VlYSAwJSwgIzc2NGJhMiAxMDAlKTsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIG1pbi1oZWlnaHQ6IDEwMHZoOwogICAgICAgICAgICBtYXJnaW46IDA7CiAgICAgICAgICAgIHBhZGRpbmc6IDIwcHg7CiAgICAgICAgfQogICAgICAgIC5jb250YWluZXIgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiB3aGl0ZTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMTBweDsKICAgICAgICAgICAgcGFkZGluZzogNDBweDsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCAxMHB4IDQwcHggcmdiYSgwLDAsMCwwLjIpOwogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgICAgIG1heC13aWR0aDogNTAwcHg7CiAgICAgICAgfQogICAgICAgIGgxIHsKICAgICAgICAgICAgY29sb3I6ICMzMzM7CiAgICAgICAgICAgIG1hcmdpbjogMCAwIDIwcHggMDsKICAgICAgICAgICAgZm9udC1zaXplOiAyZW07CiAgICAgICAgfQogICAgICAgIHAgewogICAgICAgICAgICBjb2xvcjogIzY2NjsKICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDEuNjsKICAgICAgICAgICAgbWFyZ2luOiAwIDAgMjBweCAwOwogICAgICAgIH0KICAgICAgICAuaWNvbiB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogNGVtOwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4OwogICAgICAgIH0KICAgIDwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CiAgICA8ZGl2IGNsYXNzPSJjb250YWluZXIiPgogICAgICAgIDxkaXYgY2xhc3M9Imljb24iPvCflKc8L2Rpdj4KICAgICAgICA8aDE+VW5kZXIgTWFpbnRlbmFuY2U8L2gxPgogICAgICAgIDxwPldlJ3JlIGN1cnJlbnRseSBwZXJmb3JtaW5nIHNjaGVkdWxlZCBtYWludGVuYW5jZS4gV2UnbGwgYmUgYmFjayBvbmxpbmUgc2hvcnRseS48L3A+CiAgICAgICAgPHA+VGhhbmsgeW91IGZvciB5b3VyIHBhdGllbmNlLjwvcD4KICAgIDwvZGl2Pgo8L2JvZHk+CjwvaHRtbD4K"

    json: |
      {
        "status": "maintenance",
        "message": "The service is currently under maintenance. Please try again later.",
        "code": 503
      }

    xml: |
      <?xml version="1.0" encoding="UTF-8"?>
      <response>
        <status>maintenance</status>
        <message>The service is currently under maintenance. Please try again later.</message>
        <code>503</code>
      </response>

  # Custom pages for specific ingresses/routes
  # The key becomes the page name referenced in the annotation
  # Format (HTML must be base64 encoded):
  # customPages:
  #   my-custom-page:
  #     html: "<html>...</html>"  # Plain HTML (will be used as-is)
  #     json: |
  #       {"message": "Custom message"}
  #     xml: |
  #       <?xml version="1.0"?><response>...</response>
  customPages:
    whoami-custom:
      html: |
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Scheduled Maintenance - Whoami Service</title>
            <style>
                * { margin: 0; padding: 0; box-sizing: border-box; }
                body {
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    display: flex; justify-content: center; align-items: center;
                    min-height: 100vh; padding: 20px;
                }
                .maintenance-container {
                    background: white; border-radius: 20px; padding: 60px 40px;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3); text-align: center;
                    max-width: 600px; width: 100%; animation: slideIn 0.5s ease-out;
                }
                @keyframes slideIn { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
                .icon { font-size: 80px; margin-bottom: 30px; animation: bounce 2s infinite; }
                @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
                h1 { color: #2d3748; font-size: 2.5em; margin-bottom: 20px; font-weight: 700; }
                .subtitle { color: #667eea; font-size: 1.3em; margin-bottom: 30px; font-weight: 600; }
                p { color: #4a5568; line-height: 1.8; margin-bottom: 20px; font-size: 1.1em; }
                .service-name {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white; padding: 8px 16px; border-radius: 8px;
                    font-weight: bold; display: inline-block; margin: 10px 0;
                }
                .status-badge {
                    background: #fed7d7; color: #c53030; padding: 10px 20px;
                    border-radius: 25px; font-weight: 600; display: inline-block; margin: 20px 0;
                }
                .footer {
                    margin-top: 40px; padding-top: 30px; border-top: 2px solid #e2e8f0;
                    color: #718096; font-size: 0.9em;
                }
            </style>
        </head>
        <body>
            <div class="maintenance-container">
                <div class="icon">ðŸ”§</div>
                <h1>Scheduled Maintenance</h1>
                <div class="subtitle">Whoami Service</div>
                <div class="status-badge">ðŸ”´ Currently Offline</div>
                <p>We're performing scheduled maintenance to improve your experience.</p>
                <div class="service-name">whoami.kahf.co.uk</div>
                <p>Our team is working hard to get everything back online as quickly as possible.</p>
                <div class="footer">
                    <p><strong>Expected Duration:</strong> Approximately 30 minutes</p>
                    <p><strong>Status:</strong> In Progress</p>
                </div>
            </div>
        </body>
        </html>

# Operator configuration
operator:
  # Namespaces to watch (empty means all namespaces)
  watchNamespaces: []

  # Annotation to enable maintenance mode
  maintenanceAnnotation: "maintenance-operator.kahf.io/enabled"
  maintenanceAnnotationValue: "true"

  # Annotation to specify custom maintenance page
  customPageAnnotation: "maintenance-operator.kahf.io/custom-page"

  # Annotation to store original service reference (internal use)
  backupAnnotation: "maintenance-operator.kahf.io/original-service"

  # ConfigMap name prefix for storing backups (internal use)
  backupConfigMapPrefix: "maintenance-backup"

# Cluster-wide permissions (needed for watching IngressRoutes across namespaces)
clusterRole:
  create: true
